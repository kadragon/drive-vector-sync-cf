# Task Backlog
# Remaining pending tasks sorted by priority

tasks:
  - task_id: TASK-021
    spec_id: null
    title: "Production deployment"
    priority: 1
    status: ready
    dependencies:
      - TASK-014 ✅
      - TASK-015 ✅
    estimated_effort: 3 hours
    description: |
      Deploy to Cloudflare Workers production.
      Configure all secrets via wrangler.
      Create KV namespace in production.
      Bind Vectorize index in production.
      Test with real Google Drive folder.
      Monitor first sync execution.
    test_refs: []
    notes: |
      All dependencies completed. Ready for production deployment.
      Documentation is complete and verified.

  - task_id: TASK-030
    spec_id: SPEC-web-dashboard-1
    title: "Implement dashboard UI components"
    priority: 2
    status: pending
    dependencies:
      - TASK-029
    estimated_effort: 5 hours
    description: |
      Create React components:

      1. Dashboard Layout
         - Header with title and theme toggle
         - Responsive grid layout for cards

      2. Stats Cards
         - LastSyncCard: time ago format, ISO tooltip
         - FilesProcessedCard: count with icon
         - VectorCountCard: count with icon
         - ErrorCountCard: count with alert styling

      3. Sync Status Section
         - Current status badge (Idle/In Progress/Error)
         - Next sync countdown timer
         - Progress indicator during sync

      4. Charts
         - SyncHistoryChart: Line chart (filesProcessed over time)
         - VectorCountChart: Bar chart showing vector counts
         - Recharts responsive container

      5. Action Buttons
         - Trigger Manual Sync (with token prompt)
         - Refresh Now button

      6. Hooks
         - useSyncStatus: fetch /admin/status with auto-refresh (30s)
         - useSyncStats: fetch /admin/stats
         - useSyncHistory: fetch /admin/history
         - useNextSyncTime: calculate from cron schedule

      Features:
      - Auto-refresh every 30 seconds
      - Dark mode support via DaisyUI
      - Responsive design (mobile + desktop)
      - Loading states and error handling
    test_refs:
      - TEST-web-dashboard-2
      - TEST-web-dashboard-3
      - TEST-web-dashboard-4
      - TEST-web-dashboard-5
      - TEST-web-dashboard-6
    notes: |
      Focus on clean, functional UI.
      All API calls through custom hooks.
      LocalStorage for admin token persistence (optional).

  - task_id: TASK-031
    spec_id: SPEC-web-dashboard-1
    title: "Worker integration - serve static assets"
    priority: 2
    status: pending
    dependencies:
      - TASK-030
    estimated_effort: 3 hours
    description: |
      Integrate Vite build output into Worker:

      1. Build Process
         - Add npm script to build frontend
         - Import Vite dist/ output into Worker
         - Bundle static assets as strings/modules

      2. Worker Routing
         - GET / -> serve index.html
         - GET /assets/* -> serve JS/CSS files
         - Keep existing /admin/* routes
         - Keep existing /health route

      3. Static File Serving
         - Correct Content-Type headers
         - Cache-Control headers for assets
         - ETag support for efficient caching

      4. Build Integration
         - Update wrangler.toml for frontend assets
         - CI/CD: build frontend before worker deploy
         - Development: vite dev server with API proxy

      5. CORS Configuration
         - Allow frontend dev server in development
         - Production: same-origin only
    test_refs:
      - TEST-web-dashboard-1
    notes: |
      Use esbuild or custom bundler to embed static files.
      Consider using Cloudflare R2 for large assets (future).
      For now, embed directly in Worker bundle.

  - task_id: TASK-032
    spec_id: SPEC-web-dashboard-1
    title: "Web dashboard testing and documentation"
    priority: 2
    status: pending
    dependencies:
      - TASK-031
    estimated_effort: 2 hours
    description: |
      Testing:
      - Unit tests for React components (Vitest + Testing Library)
      - Integration tests for API hooks
      - E2E test for dashboard load and interaction
      - Test auto-refresh behavior
      - Test manual sync trigger flow

      Documentation:
      - Update README with dashboard usage
      - Add screenshots of dashboard
      - Document build process
      - Document local development setup (frontend + worker)
      - Add troubleshooting for frontend issues
    test_refs:
      - TEST-web-dashboard-1
      - TEST-web-dashboard-2
      - TEST-web-dashboard-3
      - TEST-web-dashboard-4
      - TEST-web-dashboard-5
      - TEST-web-dashboard-6
    notes: |
      Ensure all acceptance tests from spec pass.
      Consider adding Playwright for E2E if needed.

  - task_id: TASK-033
    spec_id: null
    title: "Refactor folder structure: rename src/ to worker/"
    priority: 3
    status: pending
    dependencies:
      - TASK-032
    estimated_effort: 1.5 hours
    description: |
      Refactor project folder structure for clarity:

      Current structure:
        drive-vector-sync-cf/
        ├── src/              # Worker backend (ambiguous name)
        ├── frontend/         # React app
        └── package.json

      Target structure:
        drive-vector-sync-cf/
        ├── worker/           # Worker backend (clear purpose)
        ├── frontend/         # React app
        └── package.json

      Steps:
      1. Rename src/ directory to worker/
      2. Update wrangler.toml:
         - Change main = "src/index.ts" → "worker/index.ts"
      3. Update tsconfig.json:
         - Change "include": ["src/**/*"] → ["worker/**/*"]
      4. Update all import paths:
         - Find all "from 'src/*'" → "from 'worker/*'"
         - Update relative imports in test files
      5. Update package.json scripts if needed
      6. Run all tests to verify (267 tests should pass)
      7. Update .gitignore if needed
      8. Update documentation references to src/
    test_refs: []
    notes: |
      Benefits:
      - Clear separation: worker/ = Cloudflare Workers, frontend/ = React
      - Better developer experience
      - Easier onboarding for new contributors
      - Consistent with industry practices

      Risk mitigation:
      - Run full test suite after refactor
      - Verify wrangler dev still works
      - Check all import paths resolved correctly

      Should be done before production deployment for clean structure.
