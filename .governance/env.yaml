# Environment Configuration

runtime:
  platform: cloudflare-workers
  node_version: "18"
  typescript_version: "^5.0.0"

dependencies:
  core:
    - "@cloudflare/workers-types"
    - "googleapis"
    - "@qdrant/js-client-rest"
    - "openai"

  development:
    - "vitest"
    - "wrangler"
    - "@types/node"

api_versions:
  google_drive_api: "v3"
  openai_api: "v1"
  qdrant_api: "v1"

models:
  embedding:
    provider: "openai"
    model: "text-embedding-3-large"
    dimensions: 3072

constants:
  chunk_size: 2000
  max_batch_size: 32
  max_concurrency: 4
  max_retries: 3
  retry_delay_ms: 1000

cloudflare:
  cron_schedule: "0 1 * * *"  # Daily at 01:00 KST (17:00 UTC previous day)
  kv_namespaces:
    - SYNC_STATE  # For startPageToken and metadata

secrets:
  - GOOGLE_SERVICE_ACCOUNT_JSON  # Service Account credentials from Google Cloud Console
  - GOOGLE_IMPERSONATION_EMAIL  # Optional: for domain-wide delegation
  - OPENAI_API_KEY
  - QDRANT_URL
  - QDRANT_API_KEY
  - ADMIN_TOKEN  # For manual resync endpoint

qdrant:
  collection_name: "project_docs"
  vector_size: 3072
  distance: "cosine"
  hnsw_config:
    m: 16
    ef_construct: 200

google_drive:
  authentication:
    method: "service_account"  # Using Service Account with JWT
    scopes:
      - "https://www.googleapis.com/auth/drive.readonly"
    domain_wide_delegation: false  # Set to true if using GOOGLE_IMPERSONATION_EMAIL
  root_folder_id: "${ROOT_FOLDER_ID}"  # To be configured
  supported_extensions:
    - ".md"
    - ".pdf"
  file_fields: "id, name, mimeType, modifiedTime, parents"
