# Environment Configuration

runtime:
  platform: cloudflare-workers
  node_version: "18"
  typescript_version: "^5.0.0"

dependencies:
  core:
    - "@cloudflare/workers-types"
    - "googleapis"
    - "openai"
    - "tiktoken"
    - "pdfjs-dist"

  development:
    - "vitest"
    - "wrangler"
    - "@types/node"

api_versions:
  google_drive_api: "v3"
  openai_api: "v1"
  vectorize_api: "cloudflare-binding"

models:
  embedding:
    provider: "openai"
    model: "text-embedding-3-large"
    dimensions: 3072

constants:
  chunk_size: 2000
  max_batch_size: 32
  max_concurrency: 4
  max_retries: 3
  retry_delay_ms: 1000

cloudflare:
  cron_schedule: "0 1 * * *"  # Daily at 01:00 KST (17:00 UTC previous day)
  kv_namespaces:
    - SYNC_STATE  # For startPageToken and metadata
    - FILE_VECTOR_INDEX  # For file-to-vector ID mapping
  vectorize:
    binding: VECTORIZE
    index_name: "worknote-store"

secrets:
  - GOOGLE_SERVICE_ACCOUNT_JSON  # Service Account credentials from Google Cloud Console
  - GOOGLE_IMPERSONATION_EMAIL  # Optional: for domain-wide delegation
  - GOOGLE_ROOT_FOLDER_ID  # Root folder ID to sync
  - OPENAI_API_KEY
  - ADMIN_TOKEN  # For manual resync endpoint
  - WEBHOOK_URL  # Optional: for Slack/Discord alerts
  - WEBHOOK_TYPE  # Optional: slack or discord
  - PERFORMANCE_THRESHOLD  # Optional: files/sec threshold for alerts

vectorize:
  index_name: "worknote-store"
  vector_size: 3072
  distance: "cosine"
  # Note: Vectorize index must be pre-provisioned via wrangler.toml
  # No runtime configuration needed

google_drive:
  authentication:
    method: "service_account"  # Using Service Account with JWT
    scopes:
      - "https://www.googleapis.com/auth/drive.readonly"
    domain_wide_delegation: false  # Set to true if using GOOGLE_IMPERSONATION_EMAIL
  root_folder_id: "${ROOT_FOLDER_ID}"  # To be configured
  supported_extensions:
    - ".md"
    - ".pdf"
  file_fields: "id, name, mimeType, modifiedTime, parents"
