name = "worknote-maker-cf"
main = "src/index.ts"
compatibility_date = "2024-11-13"
compatibility_flags = ["nodejs_compat"]

# KV Namespace for state persistence
[[kv_namespaces]]
binding = "WORKNOTE_SYNC_STATE"
id = "PLACEHOLDER_KV_ID"
preview_id = "PLACEHOLDER_PREVIEW_KV_ID"

# KV Namespace for file-to-vector ID mapping (Vectorize migration)
[[kv_namespaces]]
binding = "WORKNOTE_FILE_VECTOR_INDEX"
id = "PLACEHOLDER_FILE_INDEX_ID"
preview_id = "PLACEHOLDER_FILE_INDEX_PREVIEW_ID"

# Cloudflare Vectorize binding (replaces Qdrant)
[[vectorize]]
binding = "VECTORIZE"
index_name = "worknote-store"

# Cron trigger - Daily at 17:00 UTC (01:00 KST next day)
[triggers]
crons = ["0 17 * * *"]

# Secrets (set via: wrangler secret put <SECRET_NAME>)
# Required:
# - GOOGLE_SERVICE_ACCOUNT_JSON (Service Account JSON from Google Cloud Console)
# - GOOGLE_ROOT_FOLDER_ID
# - OPENAI_API_KEY
# - ADMIN_TOKEN
#
# Optional:
# - GOOGLE_IMPERSONATION_EMAIL (for domain-wide delegation)
# - WEBHOOK_URL (for Slack/Discord alerts)
# - WEBHOOK_TYPE (slack or discord)
# - PERFORMANCE_THRESHOLD (files/sec, default: 0.5)

# Node.js compatibility for googleapis and other packages
node_compat = true

# Environment variables (non-sensitive)
[vars]
CHUNK_SIZE = "1000"
MAX_BATCH_SIZE = "32"
MAX_CONCURRENCY = "4"
MAX_RETRIES = "3"
INDEX_NAME = "worknote-store"
